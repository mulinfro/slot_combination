
## 语法

### 常量
连续的字符串， 无需引号

`atom b1 = 播放|打开` 中的`播放`,`打开`

### 变量及词典的引用
1. 变量 => {变量名}
2. 词典 => {.词典名}

*主要差异是词典前面会有个点"."*

### 符号
- "?" 放到元素后面表示0次或1次
- "|" 或, 连接多个元素, 表示取并集

*注意: `打开? == 打|打开`*

### list和set
1. list（有序列表）  => [item1, item2, ..]
2. set（无序列表）  =>  <item1, item2, ..>

可以嵌套

## 四种规则类型
1. atom: 常量; 把同一类词汇组织成同一个标签
2. rule: 规则(即变量)
3. plus: 重复规则体一次及以上
4. export: 用于匹配输出的完整规则, 规则体语法与rule一致

### atom
atom的元素只能是 
  - a.常量
  - b.带?的扩展常量, 
  - c. "|" 连接的常量

```python
atom b1 = 播放
atom b2 = 播放|打开|听下?
```

### rule
rule开头的, 变量, list, set及其各种组合; 
```python
rule m1 = {.歌曲}|{.英文歌曲}
rule m2 = [{b1}, {m1}?, {b2}|{m1}]
rule m3 = [{b1}?, {m1}, <{b2}, {m2}>?]
```

**注意: 不能包含常量**

### plus 
规则体的语法与rule一致, 类似于正则语法中的`(body)+`
```python
b1 = AAA|BBB
plus b1_p = {b1} => {@G2}

# G2是用户自定义的用户自定义的控制参数
#可以匹配：AAABBBAAA； AAAAAABBB； AAAXBBB(X跳过了)
```

这里`b1_p`可以匹配变量`b1`1次及重复以上，由配置决定中间能否可以跳过一定长度的字符



### export
规则体的语法与rule一致, export定义的规则是最终输出的规则
```python
export r1 = [{b1} , {m1}]  => { intent="音乐", slot=$2, @G2 }
```


### 后处理
后处理支持三种格式：
1. 槽位：`key=value`, kv对会被输出为槽位
2. 配置: `@confname`, `@`开头的规则配置名
3. 后处理函数: `@func(p1, p2, ..)`
4. 槽位的value可以是函数: `key = @func(p1, p2, ..)`, 也可以是无参函数`@func`

```python
export r1 = [{b1} , {m1}]  => { intent="音乐", slot=$2, @G2 }
export r1 = [{b1} , {m1}]  => { intent="音乐", slot=@pro($1), @dele()}
```